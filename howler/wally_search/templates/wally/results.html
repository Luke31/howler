{# {% extends "wally/base_wally.html" %}#}

{#  {% block main %}#}
{% load i18n %}

{% comment %}Translators: Sender of email{% endcomment %}
{% trans "Sender" as sender %}
{% comment %}Translators: Receiver of email{% endcomment %}
{% trans "Receiver" as receiver %}
{% trans "Attachments" as attachments %}

{% if error_message %}
    <div class="row">
        <div class='col-md-11'>
            <p><strong>{{ error_message }}</strong></p>
        </div>
    </div>
{% endif %}

{% if hit_list %}
    <table class="table table-striped-custom table-email" id="js_result_table">
        <thead>
        <tr>
            <th></th>
            <th class="text-nowrap">{% trans "Subject" %}</th>
            <th class="text-nowrap">{% trans "Sent (JST)" %}</th>
            <th class="text-nowrap">{{ sender }}</th>
            <th class="text-nowrap">{{ receiver }}</th>
            <th class="text-nowrap">{% trans "Attachment?" %}</th>
            <th class="text-nowrap text-right">{% trans "Score" %}</th>
        </tr>
        </thead>

        <tbody>
        {% for hit in hit_list %}
            <tr data-toggle="popover">
                <td class="details-control">
                    <span class="glyphicon glyphicon-plus"></span>
                    <span class="glyphicon glyphicon-minus"></span>
                </td>
                <td>
                    <span>
                        {% if hit.meta.highlight.subject.0 %}
                            {{ hit.meta.highlight.subject.0|safe }}
                        {% else %}
                            {{ hit.subject }}
                        {% endif %}
                    </span>
                    <span style="display: none">{{ hit.meta.id }}</span>
                    <div class="collapse js_popover_content">
                        <div class="panel-group">
                            <div class="panel panel-default">
                                <div class="panel-body">
                                    {% if hit.meta.highlight.replyToEmail.0 %}
                                        <p class="fragment">
                                            <b>{% trans "Hit in Reply-To Email/Name" %}:</b>
                                            {{ hit.meta.highlight.replyToEmail.0|safe }} {{ hit.meta.highlight.replyToName.0|safe }}
                                        </p>
                                    {% endif %}

                                    {% if hit.meta.highlight.fromName.0 %}
                                        <p class="fragment">
                                            <b>{% trans "Hit in sender name" %}:</b>
                                            {{ hit.meta.highlight.fromName.0|safe }}
                                        </p>
                                    {% endif %}

                                    {% if hit.meta.highlight.toName.0 %}
                                        <p class="fragment">
                                            <b>{% trans "Hit in receiver name" %}:</b> {{ hit.meta.highlight.toName.0|safe }}
                                        </p>
                                    {% endif %}

                                    {% if hit.meta.highlight.attachmentNames.0 %}
                                        <p class="fragment">
                                            <b>{% trans "Hit in attachment names" %}:</b> {{ hit.meta.highlight.attachmentNames.0|safe }}
                                        </p>
                                    {% endif %}

                                    {% if hit.meta.highlight.body %}
                                        <b>{% trans "Hits in body" %}:</b>
                                        {% for fragment in hit.meta.highlight.body %}
                                            <p class="fragment">
                                                {{ fragment|safe|linebreaks }}
                                            </p>
                                        {% endfor %}
                                    {% endif %}

                                    <a href="https://co-conv.jp/go?INFO{{ hit.meta.id }}">{% trans "View mail content" %}</a>
                                    {% comment %}
                                    <b>{% trans "Email content" %}:</b>
                                    <div id="collapse{{ forloop.counter0 }}" class="panel-collapse "><!--collapse-->
                                        <div class="panel-body">
                                            <div class="well">
                                                <p><b>{{ sender }}</b> {{ hit.fromName }} &lt;{{ hit.fromEmail }}&gt;
                                                </p>
                                                <p><b>{{ receiver }}</b> {{ hit.toName }} &lt;{{ hit.toEmail }}&gt;</p>
                                                {% if hit.attachmentNames %}
                                                    <p><b>{{ attachments }}</b> {{ hit.attachmentNames }}</p>
                                                {% endif %}

                                                {{ hit.body|linebreaks|truncatechars:EMAIL_SHOW_MAX_CHARS }}
                                            </div>
                                        </div>
                                    </div>
                                    {% endcomment %}
                                </div>
                            </div>
                        </div>
                    </div>
                </td>
                <td class="text-nowrap">
                    {{ hit.date|date:"Y/m/d H:i" }}
                </td>
                <td class="text-nowrap">
                    {% if hit.meta.highlight.fromEmail.0 %}
                        {{ hit.meta.highlight.fromEmail.0|safe }}
                    {% else %}
                        {{ hit.fromEmail }}
                    {% endif %}
                </td>
                <td class="text-nowrap">
                    {% if hit.meta.highlight.toEmail.0 %}
                        {{ hit.meta.highlight.toEmail.0|safe }}
                    {% else %}
                        {{ hit.toEmail }}
                    {% endif %}
                </td>
                <td class="text-nowrap text-center">
                    {% if hit.hasAttachment %}
                        <span class="glyphicon glyphicon-ok"></span>
                    {% endif %}
                </td>
                <td class="text-center text-nowrap js_score">
                    {{ hit.meta.score|floatformat:1 }}
                </td>
            </tr>
        {% endfor %}
        </tbody>
    </table>

{% else %}
    <div class="panel panel-warning">
        <div class="panel-heading">
            <span class="">{% trans "No emails found" %}</span>
        </div>
    </div>
{% endif %}
{#{% endblock %}#}